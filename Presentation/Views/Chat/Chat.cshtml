@model Application.ViewModel.ChatViewModel
@{
    ViewData["Title"] = "Chat";
    var currentUserId = ViewBag.currentUserId;
    var partner = Model.User1.UserId == currentUserId ? Model.User2 : Model.User1;
}

  <style>
          * {
               box-sizing: border-box;
               margin: 0;
               padding: 0;
          }

          html,
          body {
               height: 100%;
          }

          body {
               display: flex;
               justify-content: center;
               align-items: center;
               background-color: #f5f5f5;
               font-family: Arial, sans-serif;
          }

          .chat-container {
               width: 100%;
               height: 100vh;
               display: flex;
               flex-direction: column;
               border: 1px solid #ddd;
               box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
               background-color: #fff;
          }

          .chat-header {
               display: flex;
               align-items: center;
               padding: 10px;
               border-bottom: 1px solid #ddd;
               background-color: #f9f9f9;
               gap: 10px;
               align-items: center;
               justify-content: flex-end;
          }

          .chat-partner-image {
               width: 40px;
               height: 40px;
               border-radius: 50%;
               margin-right: 10px;
          }

          .chat-partner-name {
               font-size: 1.2em;
               font-weight: bold;
          }

          .chat-body {
               flex: 1;
               padding: 10px;
               overflow-y: auto;
               background-color: #fff;
               max-height: calc(100vh - 140px);
          }

          .my-message {
               display: flex;
               justify-content: flex-start;
               margin-bottom: 10px;
          }

          .partner-message {
               display: flex;
               justify-content: flex-end;
               margin-bottom: 10px;
          }

          .user-image {
               width: 30px;
               height: 30px;
               border-radius: 50%;
               margin: 0 10px;
          }

          .message-content {
               max-width: 50%;
               padding: 10px;
               border-radius: 10px;
               position: relative;
               background-color: #e1ffc7;
               word-wrap: break-word;
          }

          .my-message .message-content {
               background-color: #c7e1ff;
          }

          .message-time {
               display: block;
               font-size: 0.8em;
               color: #666;
               text-align: right;
               margin-top: 5px;
          }

          .collapsed {
               display: -webkit-box;
               -webkit-line-clamp: 4;
               -webkit-box-orient: vertical;
               overflow: hidden;
          }

          .show-more {
               color: #007bff;
               cursor: pointer;
               font-size: 0.9em;
               margin-top: 5px;
               display: inline-block;
          }

          .chat-footer {
               display: flex;
               align-items: center;
               padding: 10px;
               border-top: 1px solid #ddd;
               background-color: #f9f9f9;
          }

          .chat-footer input {
               flex: 1;
               padding: 10px;
               border: 1px solid #ddd;
               border-radius: 5px;
               margin-right: 10px;
          }

          .chat-footer button {
               padding: 10px;
               border: none;
               border-radius: 5px;
               background-color: #007bff;
               color: white;
               cursor: pointer;
               margin-right: 10px;
          }

          .chat-footer button:last-child {
               background-color: #28a745;
          }
     </style>


<div class="chat-container">
    <div class="chat-header">
        <span class="chat-partner-name">@partner.Name</span>
        <span class="chat-partner-status">@(partner.IsOnline ? "Online" : "Offline")</span>
        <img src="~/imgs/defualt-user-img.png" alt="@partner.Name" class="chat-partner-image">
    </div>

    <div class="chat-body" id="chatBody">
        @foreach (var message in Model.Messages)
        {
            var isMyMessage = message.SenderId == currentUserId;
            <div class="@(isMyMessage ? "partner-message":"my-message" )">
                @if (!isMyMessage)
                {
                    <img src="~/imgs/defualt-user-img.png" alt="@message.Sender.Name" class="user-image">
                }
                <div class="message-content">
                    <p>@message.Content</p>
                    <span class="message-time">@message.SentAt.ToString("HH:mm")</span>
                </div>
          
            </div>
        }
    </div>

    <div class="chat-footer">
        <input type="text" id="messageInput" placeholder="write your message here...">
        <button id="sendButton">Send</button>
    </div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"
        integrity="sha512-7rhBJh1om/W5Ztx7WiYOR9h2wlSaTmPyQMoHFtbT/FVNIA12y6S6I8HY9mrBS1uJ3dSU/R3qaSAXsGYuRjMDxg=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer"></script>
